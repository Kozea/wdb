/*! wdb           2015-06-24 */
var Codemirror,Log,Wdb,Websocket,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Log=function(){function a(){this.debug=$("body").attr("data-debug")||!1}return a.prototype.time=function(){var a;return a=new Date,a.getHours()+":"+a.getMinutes()+":"+(a.getSeconds()+"."+a.getMilliseconds())},a.prototype.log=function(){var a,b;return this.debug?(b="["+this.constructor.name+"] ("+this.time()+")",a=[b].concat(Array.prototype.slice.call(arguments,0)),console.log.apply(console,a)):void 0},a.prototype.fail=function(){var a,b;return b=this.constructor.name,a=[b].concat(Array.prototype.slice.call(arguments,0)),console.error.apply(console,a)},a}(),Websocket=function(a){function b(a,c){this.wdb=a,b.__super__.constructor.apply(this,arguments),this.url="ws://"+document.location.host+"/websocket/"+c,this.log("Opening new socket",this.url),this.ws=new WebSocket(this.url),this.ws.onclose=this.close.bind(this),this.ws.onopen=this.open.bind(this),this.ws.onerror=this.error.bind(this),this.ws.onmessage=this.message.bind(this)}return extend(b,a),b.prototype.close=function(a){return this.log("Closed",a),this.wdb.die()},b.prototype.error=function(a){return this.fail("Error",a)},b.prototype.open=function(a){return this.log("Open",a),this.wdb.opening()},b.prototype.message=function(a){var b,c,d,e;return d=a.data,e=d.indexOf("|"),e>-1?(b=d.substr(0,e),c=JSON.parse(d.substr(e+1))):b=d,this.log(this.time(),"<-",d),b=b.toLowerCase(),b in this.wdb?this.wdb[b.toLowerCase()](c):this.fail("Unknown command",b)},b.prototype.send=function(a,b){var c;return null==b&&(b=null),b?("string"!=typeof b&&(b=JSON.stringify(b)),c=a+"|"+b):c=a,this.log("->",c),this.ws.send(c)},b}(Log),Codemirror=function(a){function b(a){this.wdb=a,b.__super__.constructor.apply(this,arguments),this.$container=$("#source-editor"),CodeMirror.commands.save=this.save.bind(this),CodeMirror.keyMap.wdb={Esc:this.stop_edition.bind(this),fallthrough:["default"]},this.code_mirror=CodeMirror(function(a){return function(b){return a.$code_mirror=$(b),a.$container.prepend(b)}}(this),{value:"Waiting for file",theme:"wdb",keyMap:"wdb",readOnly:!0,gutters:["breaks","CodeMirror-linenumbers"],lineNumbers:!0}),this.code_mirror.on("gutterClick",this.gutter_click.bind(this)),this.state={fn:null,file:null,fun:null,lno:0},this.fun_scope=null,this.footsteps={},this.breakpoints={}}return extend(b,a),b.prototype.save=function(){var a;return a=this.code_mirror.getValue(),this.wdb.ws.send("Save",this.state.fn+"|"+a),this.state.file=a},b.prototype.gutter_click=function(a,b){return this.wdb.toggle_break(":"+(b+1))},b.prototype.clear_breakpoint=function(a){var b,c;return null==(b=this.breakpoints)[c=a.fn]&&(b[c]=[]),indexOf.call(this.breakpoints[a.fn],a)>=0&&this.breakpoints[a.fn].splice(this.breakpoints[a.fn].indexOf(a)),a.lno?(this.remove_mark(a.lno),this.remove_class(a.lno,"ask-breakpoint"),this.remove_class(a.lno,"breakpoint")):void 0},b.prototype.ask_breakpoint=function(a){return this.add_class(a,"ask-breakpoint")},b.prototype.set_breakpoint=function(a){var b,c;return null==(b=this.breakpoints)[c=a.fn]&&(b[c]=[]),this.breakpoints[a.fn].push(a),this.mark_breakpoint(a)},b.prototype.mark_breakpoint=function(a){return a.lno?(this.remove_class(a.lno,"ask-breakpoint"),this.add_class(a.lno,"breakpoint"),this.add_mark(a.lno,"breakpoint","breaks",a.temporary?"○":"●",this.brk_to_str(a))):void 0},b.prototype.brk_to_str=function(a){var b;return b=a.temporary?"Temporary ":"",b+="Breakpoint",a.fun&&(b+=" On "+a.fun),a.lno&&(b+=" At "+a.lno),a.cond&&(b+=" If "+a.cond),b},b.prototype.get_selection=function(){return this.code_mirror.getSelection().trim()},b.prototype.get_breakpoint=function(a){var b,c,d,e,f,g;for(null==(b=this.breakpoints)[f=this.state.fn]&&(b[f]=[]),g=this.breakpoints[this.state.fn],d=0,e=g.length;e>d;d++)if(c=g[d],c.lno===a)return c},b.prototype.add_class=function(a,b){return this.code_mirror.addLineClass(a-1,"background",b)},b.prototype.remove_class=function(a,b){return this.code_mirror.removeLineClass(a-1,"background",b)},b.prototype.add_mark=function(a,b,c,d,e){return this.code_mirror.setGutterMarker(a-1,c,$("<div>",{"class":b,title:e}).html(d).get(0))},b.prototype.remove_mark=function(a){return this.code_mirror.setGutterMarker(a-1,"breaks",null)},b.prototype.stop_edition=function(){return this.code_mirror.getOption("readOnly")?void 0:this.toggle_edition()},b.prototype.toggle_edition=function(){var a;return a=this.code_mirror.getOption("readOnly"),this.code_mirror.setOption("readOnly",!a),this.$code_mirror.toggleClass("rw","ro"),this.wdb.print({"for":"Toggling edition",result:"Edit mode "+(a?"on":"off")}),a?void 0:this.code_mirror.setValue(this.file)},b.prototype.open=function(a,b){var c;return c={fn:a.name,file:a.file,fun:b["function"],lno:b.lno,flno:b.flno,llno:b.llno},this.set_state(c)},b.prototype.set_state=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(r=!0,this.state.fn!==a.fn||this.state.file!==a.file)for(this.code_mirror.setValue(a.file),l=this.breakpoints[a.fn]||[],d=0,g=l.length;g>d;d++)c=l[d],this.mark_breakpoint(c);else if(this.state.fun!==a.fun&&"<module>"!==this.state.fun){for(this.remove_class(this.state.flno,"ctx-top"),i=e=m=this.state.flno,n=this.state.llno;n>=m?n>=e:e>=n;i=n>=m?++e:--e)this.remove_class(i,"ctx");this.remove_class(this.state.llno,"ctx-bottom")}else r=!1;for(this.state=a,this.code_mirror.clearGutter("CodeMirror-linenumbers"),o=this.footsteps[this.state.fn]||[],f=0,h=o.length;h>f;f++)s=o[f],this.remove_class(s,"highlighted"),this.add_class(s,"footstep");if(r&&"<module>"!==this.state.fun){for(this.add_class(this.state.flno,"ctx-top"),i=k=p=this.state.flno,q=this.state.llno;q>=p?q>=k:k>=q;i=q>=p?++k:--k)this.add_class(i,"ctx");this.add_class(this.state.llno,"ctx-bottom")}return this.add_class(this.state.lno,"highlighted"),this.add_mark(this.state.lno,"highlighted","CodeMirror-linenumbers","➤"),null==(b=this.footsteps)[j=this.state.fn]&&(b[j]=[]),this.footsteps[this.state.fn].push(this.state.lno),this.code_mirror.scrollIntoView({line:this.state.lno,ch:1},this.$code_mirror.height()/2)},b.prototype.get_mode=function(a){switch(a.split(".").splice(-1)[0]){case"py":return"python";case"jinja2":return"jinja2";case"diff":return"diff";default:return"python"}},b}(Log),Wdb=function(a){function b(){var a;b.__super__.constructor.apply(this,arguments),this.started=!1,this.to_complete=null,this.cwd=null,this.backsearch=null,this.cmd_hist=[],this.session_cmd_hist={},this.file_cache={},this.last_cmd=null,this.eval_time=null,this.waited_for_ws=0,this.$activity=$("#activity"),this.$title=$("#title"),this.$waiter=$("#waiter"),this.$wdb=$("#wdb"),this.$source=$("#source"),this.$interpreter=$("#interpreter"),this.$scrollback=$("#scrollback"),this.$prompt=$("#prompt"),this.$eval=$("#eval"),this.$completions=$("#completions"),this.$backsearch=$("#backsearch"),this.$traceback=$("#traceback"),this.$watchers=$("#watchers");try{this.cmd_hist=JSON.parse(localStorage.cmd_hist||"[]")}catch(c){a=c,this.fail(a)}this.ws=new Websocket(this,this.$wdb.find("> header").attr("data-uuid")),this.cm=new Codemirror(this),this.$eval.focus()}return extend(b,a),b.prototype.__version__="2.1.3",b.prototype.opening=function(){return this.started||(this.$eval.on("keydown",this.eval_key.bind(this)).on("keyup",this.eval_carret_change.bind(this)).on("mouseup",this.eval_carret_change.bind(this)).on("blur",this.searchback_stop.bind(this)),$(window).on("keydown",this.global_key.bind(this)),this.$traceback.on("click",".traceline",this.select_click.bind(this)),this.$scrollback.add(this.$watchers).on("click","a.inspect",this.inspect.bind(this)).on("click",".short.close",this.short_open.bind(this)).on("click",".short.open",this.short_close.bind(this)).on("click",".toggle",this.toggle_visibility.bind(this)),this.$watchers.on("click",".watching .name",this.unwatch.bind(this)),this.$source.find("#source-editor").on("mouseup",this.paste_target.bind(this)),$("#deactivate").click(this.disable.bind(this)),this.$interpreter.on("keydown",function(a){return function(b){var c,d,e,f,g;return b.ctrlKey&&37<=(c=b.keyCode)&&40>=c||118<=(d=b.keyCode)&&122>=d||13===b.keyCode?!0:!b.shiftKey||33!==(e=b.keyCode)&&34!==e?a.$eval.focus():(f=2*a.$interpreter.height()/3,g=33===b.keyCode?-1:1,a.$interpreter.stop(!0,!0).animate({scrollTop:a.$interpreter.scrollTop()+g*f},500),!1)}}(this)),this.started=!0),this.ws.send("Start"),this.$waiter.remove(),this.$wdb.show(),this.$eval.autosize()},b.prototype.working=function(){return this.$activity.addClass("on")},b.prototype.chilling=function(){return this.$activity.removeClass("on")},b.prototype.done=function(a){var b;return null==a&&(a=null),this.termscroll(),b=a||"",this.$eval.val()!==b&&this.$eval.val(b).prop("disabled",!1).attr("data-index",-1).trigger("autosize.resize").focus(),this.$completions.attr("style",""),this.chilling()},b.prototype.init=function(a){var b,c,d,e,f,g,h;for(a.version!==this.constructor.prototype.__version__&&this.print({"for":"Client Server version mismatch !",result:"Server is "+this.constructor.prototype.__version__+" and Client is "+(a.version||"<= 2.0")}),this.cwd=a.cwd,d=a.breaks,h=[],e=0,f=d.length;f>e;e++)c=d[e],null==(b=this.cm.breakpoints)[g=c.fn]&&(b[g]=[]),h.push(this.cm.breakpoints[c.fn].push(c));return h},b.prototype.title=function(a){return this.$title.text(a.title).attr("title",a.title).append($("<small>").text(a.subtitle).attr("title",a.subtitle))},b.prototype.trace=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(this.$traceback.removeClass("hidden"),this.$traceback.empty(),o=a.trace,q=[],k=0,m=o.length;m>k;k++){for(j=o[k],g=$("<div>").addClass("traceline").attr("id","trace-"+j.level).attr("data-level",j.level),p=this.cm.breakpoints[j.file]||[],l=0,n=p.length;n>l;l++)if(i=p[l],!(i.cond||i.fun||i.lno)){g.addClass("breakpoint");break}j.current&&g.addClass("real-selected"),c=$("<span>").addClass("tracefile").text(j.file),h=$("<span>").addClass("tracelno").text(j.lno),e=$("<span>").addClass("tracefun").text(j["function"]),d=$("<div>").addClass("tracefilelno").append(c).append(h),f=$("<div>").addClass("tracefunfun").append(e),j.file.indexOf("site-packages")>0&&(r=j.file.split("site-packages").slice(-1)[0],c.text(r),c.prepend($("<span>").addClass("tracestar").text("*").attr({title:j.file}))),0===j.file.indexOf(this.cwd)&&(r=j.file.split(this.cwd).slice(-1)[0],c.text(r),c.prepend($("<span>").addClass("tracestar").text(".").attr({title:j.file}))),b=$("<div>").addClass("tracecode"),this.code(b,j.code),g.append(d),g.append(b),g.append(f),q.push(this.$traceback.prepend(g))}return q},b.prototype.select_click=function(a){return this.ws.send("Select",$(a.currentTarget).attr("data-level"))},b.prototype.selectcheck=function(a){return a.name in this.file_cache?(a.file=this.file_cache[a.name],this.select(a)):this.ws.send("File",a.name)},b.prototype.select=function(a){var b;return b=a.frame,this.$interpreter.show(),this.$source.find("#source-editor").removeClass("hidden"),$(".traceline").removeClass("selected"),$("#trace-"+b.level).addClass("selected"),this.file_cache[a.name]=a.file,this.cm.open(a,b),this.done()},b.prototype.ellipsize=function(a){return a.find("span.cm-string").each(function(){var a;return a=$(this).text(),a.length>128?($(this).text(""),$(this).append($('<span class="short close">').text(a.substr(0,128))),$(this).append($('<span class="long">').text(a.substr(128)))):void 0})},b.prototype.code=function(a,b,c,d,e,f){var g,h,i,j,k;if(null==c&&(c=[]),null==d&&(d=!1),null==e&&(e=null),null==f&&(f="python"),d)h="<"!==b[0]||">"!==b.slice(-1)?$("<div>",{"class":"out"}).html(b):$(b),a.append(h),h.add(h.find("*")).contents().filter(function(){return 3===this.nodeType&&this.nodeValue.length>0&&!$(this.parentElement).closest("thead").size()}).wrap("<code>").parent().each(function(a){return function(b,d){var g,h,i,j;for(g=$(d),g.addClass("waiting_for_hl").addClass("CodeMirror-standalone"),i=0,j=c.length;j>i;i++)h=c[i],g.addClass(h);return e&&g.attr("title",e),setTimeout(function(){return CodeMirror.runMode(g.text(),f,g.get(0)),g.removeClass("waiting_for_hl"),a.ellipsize(g)},50)}}(this));else{for(g=$("<code>",{"class":"CodeMirror-standalone"}),j=0,k=c.length;k>j;j++)i=c[j],g.addClass(i);e&&g.attr("title",e),a.append(g),CodeMirror.runMode(b,f,g.get(0)),this.ellipsize(g)}return g},b.prototype.historize=function(a){var b;this.cm.state.fn in this.session_cmd_hist||(this.session_cmd_hist[this.cm.state.fn]=[]);for(;-1!==(b=this.cmd_hist.indexOf(a));)this.cmd_hist.splice(b,1);return this.cmd_hist.unshift(a),this.session_cmd_hist[this.cm.state.fn].unshift(a),localStorage&&(localStorage.cmd_hist=JSON.stringify(this.cmd_hist))},b.prototype.execute=function(a){var b,c,d,e;if(console.log(a),a=a.trim(),this.historize(a),b=function(a){return function(){return a.ws.send.apply(a.ws,arguments),a.last_cmd=arguments,a.working()}}(this),0!==a.indexOf("."))return 0===a.indexOf("?")?(b("Dump",a.slice(1).trim()),void this.suggest_stop()):""===a&&this.last_cmd?void b.apply(this,this.last_cmd):a?(this.working(),this.ws.send("Eval",a),this.$eval.val(this.$eval.val()+"...").trigger("autosize.resize").prop("disabled",!0),this.eval_time="undefined"!=typeof performance&&null!==performance?performance.now():void 0):void 0;switch(e=a.indexOf(" "),e>-1?(d=a.substr(1,e-1),c=a.substr(e+1)):(d=a.substr(1),c=""),d){case"a":this.print_hist(this.session_cmd_hist[this.cm.state.fn]);break;case"b":this.toggle_break(c);break;case"c":b("Continue");break;case"d":c&&b("Dump",c);break;case"e":this.cm.toggle_edition();break;case"f":c&&b("Find",c);break;case"g":this.cls();break;case"h":this.print_help();break;case"i":c&&b("Display",c);break;case"j":c&&b("Jump",c);break;case"l":b("Breakpoints");break;case"n":b("Next");break;case"q":b("Quit");break;case"r":b("Return");break;case"s":b("Step");break;case"t":this.toggle_break(c,!0);break;case"u":b("Until");break;case"w":c&&b("Watch",c);break;case"x":c&&b("Diff",c);break;case"z":this.toggle_break(c,!1,!0)}},b.prototype.cls=function(){return this.$scrollback.empty(),this.searchback_stop(),this.suggest_stop(),this.multiline_stop(),this.done()},b.prototype.print_hist=function(a){return this.print({"for":"History",result:a.slice(0).reverse().filter(function(a){return 0!==a.indexOf(".")}).join("\n")})},b.prototype.print_help=function(){return this.print({"for":"Supported commands",result:".s or [Alt] + [↓] or [F11]     : Step into\n.n or [Alt] + [→] or [F10]     : Step over (Next)\n.r or [Alt] + [↑] or [F9]      : Step out (Return)\n.c or [Alt] + [Enter] or [F8]  : Continue\n.u or [Alt] + [←] or [F7]     : Until (Next over loops)\n.j lineno                      : Jump to lineno (Must be at bottom frame and in the same function)\n.b arg                         : Set a session breakpoint  see below for what arg can be*\n.t arg                         : Set a temporary breakpoint, arg follow the same syntax as .b\n.z arg                         : Delete existing breakpoint\n.l                             : List active breakpoints\n.a                             : Echo all typed commands in the current debugging session\n.d expression                  : Dump the result of expression in a table\n.w expression                  : Watch expression in curent file (Click on the name to remove)\n.q                             : Quit\n.h                             : Get some help\n.e                             : Toggle file edition mode\n.g                             : Clear prompt\n.i [mime/type;]expression      : Display the result in an embed, mime type defaults to \"text/html\"\n.x left ? right                : Display the difference between the pretty print of 'left' and 'right'\n.x left <> right               : Display the difference between the repr of 'left' and 'right'\n.f key in expression           : Search recursively the presence of key in expression object tree\n.f test of expression          : Search recursively values that match test in expression inner tree.\n i.e.: .f type(x) == int of sys\n\nAll the upper commands are prefixed with a dot and can be executed with [Alt] + [the command letter], i.e.: [Alt] + [h]\n\niterable!sthg                  : If cutter is installed, executes cut(iterable).sthg\nexpr >! file                   : Write the result of expr in file\n!< file                        : Eval the content of file\n[Enter]                        : Eval the current selected text in page, useful to eval code in the source\n[Shift] + [Enter]              : Insert the current selected text in page in the prompt\n[Ctrl] + [Enter]               : Multiline prompt or execute if already in multiline mode.\n\n* arg is using the following syntax:\n    [file/module][:lineno][#function][,condition]\nwhich means:\n    - [file]                    : Break if any line of `file` is executed\n    - [file]:lineno             : Break on `file` at `lineno`\n    - [file][:lineno],condition : Break on `file` at `lineno` if `condition` is True (ie: i == 10)\n    - [file]#function           : Break when inside `function` function\nFile is always current file by default and you can also specify a module like `logging.config`."})},b.prototype.termscroll=function(){return this.$interpreter.stop(!0).animate({scrollTop:this.$scrollback.height()},1e3)},b.prototype.print=function(a){var b,c,d;return performance&&this.eval_time&&(c=parseInt(1e3*(performance.now()-this.eval_time)),this.eval_time=null),this.suggest_stop(),d=this.$eval.val(),b=$("<div>"),this.$scrollback.append(b),a.duration&&this.code(b,this.pretty_time(a.duration),["duration"],!1,"Total "+this.pretty_time(c)),this.code(b,a["for"],["prompted"]),this.code(this.$scrollback,a.result,[],!0),this.done(a.suggest)},b.prototype.echo=function(a){return this.code(this.$scrollback,a["for"],["prompted"]),this.code(this.$scrollback,a.val||"",[],!0,null,a.mode),this.done()},b.prototype.rawhtml=function(a){return this.code(this.$scrollback,a["for"],["prompted"]),this.$scrollback.append(a.val),this.done()},b.prototype.dump=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;this.code(this.$scrollback,a["for"],["prompted"]),d=$("<div>"),i=$("<table>",{"class":"object"}).appendTo(d),e=$("<thead>",{"class":"toggle closed"}).append($("<tr>").append($("<td>",{"class":"core",colspan:2}).text("Core Members"))).appendTo(i),f=$("<tbody>",{"class":"core closed"}).appendTo(i),g=$("<thead>",{"class":"toggle closed"}).append($("<tr>").append($("<td>",{"class":"method",colspan:2}).text("Methods"))).appendTo(i),h=$("<tbody>",{"class":"method closed"}).appendTo(i),b=$("<thead>",{"class":"toggle closed"}).append($("<tr>").append($("<td>",{"class":"attr",colspan:2}).text("Attributes"))).appendTo(i),c=$("<tbody>",{"class":"attr closed"}).appendTo(i),l=a.val;for(k in l)m=l[k],j=c,0===k.indexOf("__")&&-1!==k.indexOf("__",k.length-2)?j=f:-1!==m.type.indexOf("method")&&(j=h),j.append($("<tr>").append($("<td>").text(k)).append($("<td>").html(m.val)));return 0===f.find("tr").size()&&(e.remove(),f.remove()),0===c.find("tr").size()&&(b.remove(),c.remove()),0===h.find("tr").size()&&(g.remove(),h.remove()),a.doc&&(i.append($("<thead>",{"class":"toggle closed"}).append($("<tr>").append($("<td>",{"class":"doc",colspan:2}).text("Documentation")))),$("<tbody>",{"class":"doc closed"}).append($("<tr>").append($("<td>",{"class":"doc",colspan:2}).text(a.doc))).appendTo(i)),a.source&&(i.append($("<thead>",{"class":"toggle closed"}).append($("<tr>").append($("<td>",{"class":"source",colspan:2}).text("Source")))),$("<tbody>",{"class":"source closed"}).append($("<tr>").append($("<td>",{"class":"source",colspan:2}).text(a.source))).appendTo(i)),this.code(this.$scrollback,d.html(),[],!0),this.done()},b.prototype.breakset=function(a){var b;return this.cm.set_breakpoint(a),a.lno||a.fun||a.cond||this.$traceback.find('[title="'+a.fn+'"]').closest(".traceline").addClass("breakpoint"),"."!==this.$eval.val()[0]||"b"!==(b=this.$eval.val()[1])&&"t"!==b?this.chilling():this.done()},b.prototype.breakunset=function(a){var b;return this.cm.clear_breakpoint(a),a.lno||a.fun||a.cond||this.$traceback.find('[title="'+a.fn+'"]').closest(".traceline").removeClass("breakpoint"),"."!==this.$eval.val()[0]||"b"!==(b=this.$eval.val()[1])&&"t"!==b&&"z"!==b?this.chilling():this.done()},b.prototype.split=function(a,b){var c;return indexOf.call(a,b)>=0?(c=a.split(b),[c[0],c.slice(1).join(b).trim()]):[a,null]},b.prototype.toggle_break=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;for(null==b&&(b=!1),null==c&&(c=!1),d={lno:null,cond:null,fun:null,fn:null,temporary:b},n=a,j=this.split(n,","),n=j[0],d.cond=j[1],k=this.split(n,"#"),n=k[0],d.fun=k[1],l=this.split(n,":"),n=l[0],d.lno=l[1],d.fn=n||this.cm.state.fn,d.lno=parseInt(d.lno)||null,g=!1,m=this.cm.breakpoints[d.fn]||[],h=0,i=m.length;i>h;h++)if(f=m[h],f.fn===d.fn&&f.lno===d.lno&&f.cond===d.cond&&f.fun===d.fun&&(f.temporary===d.temporary||c)){g=!0,d=f;break}return g||c?(this.cm.clear_breakpoint(d),e="Unbreak",d.temporary||(e="Broadcast|"+e),this.ws.send(e,d),void this.working()):(d.lno&&this.cm.ask_breakpoint(d.lno),e="Break",b||(e="Broadcast|"+e),this.ws.send(e,d),this.working())},b.prototype.format_fun=function(a){var b,c,d,e,f,g,h;for(h=[$("<span>",{"class":"fun_name",title:a.module}).text(a.call_name),$("<span>",{"class":"fun_punct"}).text("(")],g=a.params,c=d=0,e=g.length;e>d;c=++d)f=g[c],b="fun_param",(c===a.index||c===a.params.length-1&&a.index>c)&&(b="fun_param active"),h.push($("<span>",{"class":b}).text(f)),c!==a.params.length-1&&h.push($("<span>",{"class":"fun_punct"}).text(", "));return h.push($("<span>",{"class":"fun_punct"}).text(")")),h},b.prototype.suggest=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(a){for(c=this.$completions.find("table").empty(),c.append($('<thead><tr><th id="comp-desc" colspan="5">')),i=this.$completions.height(),f=[],p=a.params,k=0,m=p.length;m>k;k++)o=p[k],$("#comp-desc").append(this.format_fun(o));for(a.completions.length&&(d=$("<tbody>"),g=a.completions[0].base.length,t=this.$eval.get(0),s=t.selectionStart,this.$eval.data({start:this.$eval.val().substr(0,s-g),end:this.$eval.val().substr(s)})),q=a.completions,j=l=0,n=q.length;n>l;j=++l)h=q[j],r=h.base+h.complete,indexOf.call(f,r)>=0||(f.push(h.base+h.complete),j%5===0&&d.append(b=$("<tr>")),b.append(e=$("<td>").attr("title",h.description).append($("<span>").addClass("base").text(h.base)).append($("<span>").addClass("completion").text(h.complete))),h.complete||(e.addClass("complete"),$("#comp-desc").html(e.attr("title"))));c.append(d),this.$completions.height(Math.max(i,c.height())),this.termscroll()}return this.to_complete?(this.ws.send("Complete",this.to_complete),this.to_complete=!1):this.to_complete=null},b.prototype.suggest_stop=function(){return this.$completions.find("table td,table tr").size()?(this.$completions.find("table").empty(),!0):!1},b.prototype.watched=function(a){var b,c,d,e,f;for(f in a)hasProp.call(a,f)&&(e=a[f],d=this.$watchers.find(".watching").filter(function(a){return $(a).attr("data-expr")===f}),d.size()?(d.find(".value code").remove(),this.code(d.find(".value"),e.toString(),[],!0)):(b=$("<code>",{"class":"name"}),c=$("<div>",{"class":"value"}),this.$watchers.append(d=$("<div>",{"class":"watching"}).attr("data-expr",f).append(b.text(f),$("<code>").text(": "),c)),this.code(c,e.toString(),[],!0)),d.addClass("updated"));return this.$watchers.find(".watching:not(.updated)").remove(),this.$watchers.find(".watching").removeClass("updated"),this.done()},b.prototype.ack=function(){return this.$eval.val("").trigger("autosize.resize")},b.prototype.display=function(a){var b,c;return this.suggest_stop(),c=this.$eval.val(),this.code(this.$scrollback,a["for"],["prompted"]),b=a.type.indexOf("image")>=0?$("<img>"):a.type.indexOf("audio")>=0?$("<audio>",{controls:"controls",autoplay:"autoplay"}):a.type.indexOf("video")>=0||a.type.indexOf("/ogg")>=0?$("<video>",{controls:"controls",autoplay:"autoplay"}):$("<iframe>"),b.addClass("display"),b.attr("src","data:"+a.type+";charset=UTF-8;base64,"+a.val),this.$scrollback.append(b),this.done()},b.prototype.searchback=function(){var a,b,c,d,e,f,g;for(this.suggest_stop(),b=this.backsearch,g=this.$eval.val(),f=this.cmd_hist,c=0,d=f.length;d>c;c++)if(a=f[c],e=new RegExp("("+g+")","gi"),e.test(a)&&(b--,0===b))return void this.$backsearch.html(a.replace(e,'<span class="backsearched">$1</span>'));return 1===this.backsearch?void this.searchback_stop():this.backsearch=Math.max(this.backsearch-1,1)},b.prototype.searchback_stop=function(a){return this.backsearch?(a===!0&&this.$eval.val(this.$backsearch.text()).trigger("autosize.resize"),this.$backsearch.html(""),this.backsearch=null,!0):!1},b.prototype.die=function(){return $("h1").html("Dead<small>Program has exited</small>"),this.ws.ws.close(),setTimeout(function(){return window.close()},10)},b.prototype.multiline_stop=function(){return this.$prompt.hasClass("multiline")?(this.$prompt.removeClass("multiline"),!0):!1},b.prototype.global_key=function(a){var b,c,d,e,f,g;if(this.cm.rw)return!0;if(a.altKey&&(65<=(d=a.keyCode)&&90>=d||37<=(e=a.keyCode)&&40>=e||13===a.keyCode)||118<=(f=a.keyCode)&&122>=f)return b=function(){switch(a.keyCode){case 37:case 118:return"u";case 13:case 119:return"c";case 38:case 120:return"r";case 39:case 121:return"n";case 40:case 122:return"s";default:return String.fromCharCode(a.keyCode)}}(),b=b.toLowerCase(),c="",("b"===b||"t"===b||"z"===b)&&(c+=" :"+this.cm.state.lno),"i"===b&&(c=getSelection().toString()),this.execute("."+b+c),!1;if(13===a.keyCode){if(g=getSelection().toString(),!g)return;return a.shiftKey?this.eval_insert(g):(this.historize(g),this.execute(g)),!1}},b.prototype.eval_key=function(a){var b,c,d;if(a.altKey&&82===a.keyCode&&this.backsearch)return this.backsearch=Math.max(this.backsearch-1,1),this.searchback(),!1;if(!a.altKey){if(a.ctrlKey)switch(a.keyCode){case 13:return this.$prompt.hasClass("multiline")?(this.$prompt.removeClass("multiline"),this.execute(this.$eval.val()),!1):(this.$prompt.addClass("multiline"),this.eval_insert("\n"),!0);case 82:return null==this.backsearch&&(this.backsearch=0),a.shiftKey?this.backsearch=Math.max(this.backsearch-1,1):this.backsearch++,this.searchback(),!1;case 67:return this.searchback_stop(),!1;case 68:return this.ws.send("Quit"),!1;case 32:this.eval_move_suggest(1,!0)}switch(a.keyCode){case 13:if(this.backsearch)return this.searchback_stop(!0),!1;if(b=this.$completions.find("table"),b.find("td.active").size()&&!b.find("td.complete").size())return this.suggest_stop(),!1;if(!this.$prompt.hasClass("multiline"))return this.execute(this.$eval.val()),!1;break;case 27:return this.searchback_stop()||this.suggest_stop()||this.multiline_stop(),!1;case 9:case 39:if(c=this.$eval.get(0).selectionStart===this.$eval.val().length,d=this.$prompt.hasClass("multiline"),9===a.keyCode&&d)return this.eval_insert("  "),!1;if(39!==a.keyCode||c||d){if(this.backsearch)return!1;if(this.eval_move_suggest(a.shiftKey?-1:1,!d))return!1}return!0;case 37:return this.eval_move_suggest(-1)?!1:!0;case 38:return this.eval_move_suggest(-5)?!1:this.$prompt.hasClass("multiline")?!0:(this.eval_move_history(1),!1);case 40:return this.eval_move_suggest(5)?!1:this.$prompt.hasClass("multiline")?!0:(this.eval_move_history(-1),!1)}}},b.prototype.eval_insert=function(a){var b,c,d;return d=this.$eval.get(0),c=d.selectionStart,b=d.selectionEnd,this.$eval.val(this.$eval.val().substring(0,c)+a+this.$eval.val().substring(b,this.$eval.val().length)),d.setSelectionRange(c+a.length,c+a.length),this.$eval.trigger("autosize.resize")},b.prototype.eval_move_suggest=function(a,b){var c,d,e,f,g,h;if(null==b&&(b=!1),d=this.$completions.find("table td"),c=d.filter(".active"),!d.length)return!1;if(c.length)g=d.index(c),g+=a,0>g&&(g=d.length-1),g>=d.length&&(g=0),c.removeClass("active complete"),c=d.eq(g).addClass("active");else{if(!b)return!1;c=d.first().addClass("active")}return e=c.find(".base").text(),f=c.find(".completion").text(),h=this.$eval.data().start+e+f,this.$eval.val(h+this.$eval.data().end),this.$eval.get(0).setSelectionRange(h.length,h.length),this.$eval.trigger("autosize.resize"),$("#comp-desc").text(c.attr("title")),this.termscroll(),!0},b.prototype.eval_move_history=function(a){var b,c;return b=parseInt(this.$eval.attr("data-index"))+a,b>=-1&&b<this.cmd_hist.length?(c=-1===b?this.$eval.attr("data-current"):this.cmd_hist[b],0===b&&1===a&&this.$eval.attr("data-current",this.$eval.val()),this.$eval.val(c).attr("data-index",b).trigger("autosize.resize"),this.suggest_stop(),this.termscroll()):void 0},b.prototype.eval_before_cursor=function(){var a,b;return b=this.$eval.get(0),a=b.selectionStart,this.$eval.val().substring(0,a)},b.prototype.eval_carret_change=function(a){var b,c,d,e;return this.$completions.find("table td").filter(".active").size()?(b=this.$eval.get(0).selectionStart===this.$eval.val().length,c=this.$prompt.hasClass("multiline"),void(a.keyCode&&a.keyCode<27||37<=(d=a.keyCode)&&40>=d||a.ctrlKey&&32===a.keyCode||this.suggest_stop())):(e=this.eval_before_cursor(),this.backsearch?void(e?(this.backsearch=1,this.searchback()):this.searchback_stop()):e&&"."!==e[0]?null===this.to_complete?(this.ws.send("Complete",e),this.to_complete=!1):this.to_complete=e:void 0)},b.prototype.inspect=function(a){return this.ws.send("Inspect",$(a.currentTarget).attr("href")),this.working(),!1},b.prototype.short_open=function(a){return $(a.currentTarget).addClass("open").removeClass("close").next(".long").show("fast")},b.prototype.short_close=function(a){return $(a.currentTarget).addClass("close").removeClass("open").next(".long").hide("fast")},b.prototype.toggle_visibility=function(a){return $(a.currentTarget).add($(a.currentTarget).next()).toggleClass("closed","shown")},b.prototype.unwatch=function(a){return this.ws.send("Unwatch",$(a.currentTarget).closest(".watching").attr("data-expr")),this.working()},b.prototype.paste_target=function(a){var b;if(2===a.which)return b=$(a.target).text().trim(),this.historize(b),this.ws.send("Dump",b),this.working(),!1},b.prototype.disable=function(){return this.ws.send("Disable")},b.prototype.shell=function(){return this.$traceback.addClass("hidden"),this.$source.find("#source-editor").addClass("hidden"),this.done()},b.prototype.pretty_time=function(a){return 1e3>a?a+"μs":(a/=1e3,10>a?a.toFixed(2)+"ms":100>a?a.toFixed(1)+"ms":1e3>a?a.toFixed(0)+"ms":(a/=1e3,10>a?a.toFixed(2)+"s":100>a?a.toFixed(1)+"s":a.toFixed(0)+"s"))},b}(Log),$(function(a){return function(){return a.wdb=new Wdb}}(this));